{% extends 'base.html' %}
{% block content %}
<h2>{{ 'Edit Product' if product else 'New Product' }}</h2>
<form method="post" class="form" enctype="multipart/form-data">
  <label>Name <span style="color: #c62828;">*</span><input name="name" value="{{ product.name if product else '' }}" required></label>
  <label>Description <span style="color: #c62828;">*</span><textarea name="description" required>{{ product.description if product else '' }}</textarea></label>
  <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.75rem; align-items:end;">
    <label>MRP <small style="color:#666; font-weight:500;">(optional)</small>
      <input type="number" step="0.01" name="mrp" value="{{ product.mrp if product and product.mrp is not none else '' }}" placeholder="e.g., 699.00">
    </label>
    <label>Price <span style="color: #c62828;">*</span>
      <input type="number" step="0.01" name="price" value="{{ product.price if product else '' }}" required placeholder="e.g., 599.00">
    </label>
    <label>Size <small style="color:#666; font-weight:500;">(e.g., 500g, 1kg, etc.)</small>
      <input type="text" name="size" value="{{ product.size if product and product.size else 'Standard' }}" placeholder="e.g., 500g">
    </label>
  </div>
  <label>Stock<input type="number" name="stock" value="{{ product.stock if product else 0 }}" required></label>
  
  <label>Product Status <span style="color: #c62828;">*</span>
    <select name="product_status" required>
      <option value="Upcoming Harvest" {% if product and product.product_status == 'Upcoming Harvest' %}selected{% endif %}>Upcoming Harvest</option>
      <option value="Harvest Complete" {% if product and product.product_status == 'Harvest Complete' %}selected{% endif %}>Harvest Complete</option>
      <option value="Final Product" {% if product and (not product or product.product_status == 'Final Product') %}selected{% endif %}>Final Product</option>
    </select>
  </label>

  <label>Product Category <span style="color: #c62828;">*</span>
    <select name="category" required>
      <option value="Products" {% if product and product.category == 'Products' %}selected{% endif %}>üì¶ Products</option>
      <option value="gutcare" {% if product and product.category == 'gutcare' or product and product.category == 'Gut Care' %}selected{% endif %}>üåø Gut Care</option>
      <option value="corporate" {% if product and product.category == 'corporate' or product and product.category == 'Corporate' %}selected{% endif %}>üè¢ Corporate</option>
      <option value="gifts" {% if product and product.category == 'gifts' or product and product.category == 'Gifts' %}selected{% endif %}>üéÅ Gifts</option>
    </select>
  </label>
  
  <fieldset>
    <legend>Product Image <span style="color: #c62828;">*</span></legend>
    {% if product and product.image_path %}
    <div style="margin-bottom: 0.8rem;">
      <img src="{{ url_for('static', filename=product.image_path) }}" alt="{{ product.name }}" style="max-width: 150px; height: auto; border-radius: 4px;">
      <p style="font-size: 0.85rem; margin-top: 0.3rem; color: #666;">Current: {{ product.image_path }}</p>
    </div>
    {% endif %}
    <label>Upload Image (JPG/PNG) <span style="color: #c62828;">*</span><input type="file" name="image" accept="image/*" {% if not product %}required{% endif %}></label>
    <p class="note">{% if product %}Leave blank to keep current image.{% else %}Image is required for new products.{% endif %}</p>
  </fieldset>
  
  <fieldset>
    <legend>Display Options</legend>
    <label style="display:flex; align-items:center; gap:0.5rem;">
      <input type="checkbox" name="is_homepage" {% if product and product.is_homepage %}checked{% endif %}>
      <strong>Display on Home Page</strong> (when no region is selected)
    </label>
    <p class="note">Check this to show this product on the default home page when visitors haven't selected a region.</p>
  </fieldset>

  <fieldset>
    <legend>Product Availability by Region <span style="color: #c62828;">*</span></legend>
    <p class="note">Select regions where this product is available, or select "All Regions" to make it available everywhere.</p>
    <div class="actions" style="margin-bottom:0.5rem;">
      <label style="display:flex; align-items:center; gap:0.4rem;">
        <input type="checkbox" id="regions_select_all" {% if 'all' in selected_regions %}checked{% endif %}> <strong>All Regions (Default)</strong>
      </label>
    </div>
    <div class="grid">
      {% for r in regions %}
      <label style="display:flex; align-items:center; gap:0.4rem;">
        <input type="checkbox" name="regions" value="{{ r.id }}" {% if r.id in selected_regions %}checked{% endif %}>
        {{ r.name }}
      </label>
      {% endfor %}
    </div>
  </fieldset>

  <fieldset>
    <legend>Estimated Delivery</legend>
    <label>Days<input type="number" name="estimated_delivery_days" value="{{ product.estimated_delivery_days if product else '' }}"></label>
    <label>Date (YYYY-MM-DD)<input name="estimated_delivery_date" value="{{ product.estimated_delivery_date if product else '' }}"></label>
    <p class="note">Provide either days or a specific date.</p>
  </fieldset>
  <button type="submit">Save</button>
  <a class="btn secondary" href="{{ url_for('admin_products') }}">Cancel</a>
</form>
<script>
  (function(){
    const toggle = document.getElementById('regions_select_all');
    if (!toggle) return;
    toggle.addEventListener('change', function(){
      const boxes = document.querySelectorAll('input[type="checkbox"][name="regions"]');
      boxes.forEach(b => { b.checked = toggle.checked; });
    });
  })();
</script>
{% endblock %}
